import{u as M,r as h,j as e,L as _,a as v}from"./app-fd1574aa.js";import{L}from"./Layout-0818be15.js";/* empty css            */function z({year:s,members:u,stats:l,availableYears:j,filter:m,annualConfig:x}){const{auth:r}=M().props,[o,g]=h.useState(null),[b,a]=h.useState(!1),[i,f]=h.useState(!1),[y,N]=h.useState(null);h.useEffect(()=>{let t=0,d=!1;const c=w=>{window.scrollY===0&&(t=w.touches[0].pageY,d=!0)},A=w=>{if(!d)return;w.touches[0].pageY-t>100&&(d=!1,v.reload())},P=()=>{d=!1};return document.addEventListener("touchstart",c),document.addEventListener("touchmove",A),document.addEventListener("touchend",P),()=>{document.removeEventListener("touchstart",c),document.removeEventListener("touchmove",A),document.removeEventListener("touchend",P)}},[]);const n=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],p=t=>{const d=m||"active";v.get(`/payments?year=${t}&filter=${d}`)},E=t=>{const d=t.target.value;v.get(`/payments?year=${s}&filter=${d}`)},S=(t,d,c)=>{g({...c,member_id:t.id,member_name:t.name,month:d,month_name:n[d-1]}),a(!0)},k=t=>{N(t),f(!0)},D=t=>{if(!t)return"bg-gray-50 border-gray-200";if(t.is_annual)return"bg-purple-50 border-purple-300 text-purple-900";switch(t.status){case"paid":return"bg-green-50 border-green-300 text-green-900";case"pending":return"bg-yellow-50 border-yellow-300 text-yellow-900";case"overdue":return"bg-red-50 border-red-300 text-red-900";case"exempt":return"bg-gray-100 border-gray-400 text-gray-600";default:return"bg-gray-50 border-gray-200"}},C=(t,d)=>!t||!t.status?"":t.status==="exempt"?t.exemption==="pocasni"?"POC":t.exemption==="saradnik"?"SAR":"OTH":t.status==="paid"?t.is_annual?t.amount>0?`${Math.round(t.amount)}A`:"A":Math.round(t.amount):t.status==="overdue"?"!":"â—‹";return e.jsxs(L,{children:[e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6",children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-gray-800",children:["Payments - ",s]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{value:m??"active",onChange:E,className:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"active",children:"Active"})]}),e.jsx("select",{value:s,onChange:t=>p(t.target.value),className:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:j.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx(_,{href:`/payments/export-template/${s}`,className:"hidden sm:inline-flex px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"ðŸ“¥ Download"}),e.jsx(_,{href:"/payments/import",className:"hidden sm:inline-flex px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"ðŸ“¤ Import"}),e.jsx(_,{href:`/payments/initialize?year=${s+1}`,className:"hidden sm:inline-flex px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"âž• Initialize"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3 sm:gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-3 sm:p-4 rounded-lg shadow col-span-2 sm:col-span-1",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Total Collected"}),e.jsxs("div",{className:"text-lg sm:text-2xl font-bold text-green-600",children:[Number((l==null?void 0:l.total_collected)||0).toLocaleString()," RSD"]})]}),e.jsxs("div",{className:"bg-white p-3 sm:p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Paid"}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-green-600",children:(l==null?void 0:l.paid_count)||0})]}),e.jsxs("div",{className:"bg-white p-3 sm:p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Pending"}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-yellow-600",children:(l==null?void 0:l.pending_count)||0})]}),e.jsxs("div",{className:"bg-white p-3 sm:p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Overdue"}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-red-600",children:(l==null?void 0:l.overdue_count)||0})]}),e.jsxs("div",{className:"bg-white p-3 sm:p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Exempt"}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-600",children:(l==null?void 0:l.exempt_count)||0})]})]}),e.jsx("div",{className:"hidden md:block bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase sticky left-0 bg-gray-50 z-10",children:"Member"}),e.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"#"}),e.jsx("th",{className:"px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase",children:"Annual"}),n.map((t,d)=>e.jsx("th",{className:"px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase",children:t},d))]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-3 py-2 text-sm font-medium text-gray-900 sticky left-0 bg-white z-10",children:[t.name,t.exemption_status!=="none"&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",t.exemption_status,")"]})]}),e.jsx("td",{className:"px-2 py-2 text-sm text-gray-500",children:t.membership_number}),e.jsx("td",{className:"px-2 py-2 text-center",children:e.jsx("button",{onClick:()=>k(t),className:"px-2 py-1 bg-purple-600 text-white text-xs rounded hover:bg-purple-700",title:`Pay Annual: ${Number((x==null?void 0:x.annual_amount)||32e3).toLocaleString()} RSD`,children:"A"})}),[1,2,3,4,5,6,7,8,9,10,11,12].map(d=>{const c=t.months[d];return e.jsx("td",{onClick:()=>S(t,d,c),className:`px-2 py-2 text-center text-xs font-semibold border cursor-pointer hover:opacity-75 ${D(c)}`,children:C(c)},d)})]},t.id))})]})})}),e.jsx("div",{className:"md:hidden bg-white rounded-lg shadow divide-y divide-gray-200",children:u.map(t=>e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["#",t.membership_number,t.exemption_status!=="none"&&e.jsxs("span",{className:"ml-2",children:["(",t.exemption_status,")"]})]})]}),e.jsx("button",{onClick:()=>k(t),className:"px-3 py-1.5 bg-purple-600 text-white text-sm rounded hover:bg-purple-700",children:"Annual"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1.5",children:[1,2,3,4,5,6,7,8,9,10,11,12].map(d=>{const c=t.months[d];return e.jsxs("button",{onClick:()=>S(t,d,c),className:`px-2 py-2 text-xs font-medium rounded border text-center ${D(c)}`,children:[e.jsx("div",{className:"text-[10px] text-gray-500",children:n[d-1]}),e.jsx("div",{children:C(c)||"-"})]},d)})})]},t.id))}),e.jsxs("div",{className:"mt-4 flex gap-4 text-sm flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-200 border border-green-300"}),e.jsx("span",{children:"Paid"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-purple-200 border border-purple-300"}),e.jsx("span",{children:"Annual"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-yellow-200 border border-yellow-300"}),e.jsx("span",{children:"Pending"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-200 border border-red-300"}),e.jsx("span",{children:"Overdue"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200 border border-gray-400"}),e.jsx("span",{children:"Exempt"})]})]})]}),b&&e.jsx($,{payment:o,year:s,onClose:()=>a(!1),canDelete:r.user.role_id===1||r.user.role_id===2}),i&&e.jsx(O,{member:y,year:s,annualConfig:x,onClose:()=>f(!1)})]})}function $({payment:s,year:u,onClose:l,canDelete:j}){const m=new Date().toISOString().split("T")[0],x=a=>{if(!a)return m;if(a.includes(".")){const i=a.split(".");if(i.length===3)return`${i[2]}-${i[1].padStart(2,"0")}-${i[0].padStart(2,"0")}`}return a},[r,o]=h.useState({paid_amount:(s==null?void 0:s.amount)||(s==null?void 0:s.expected)||"",payment_status:(s==null?void 0:s.status)||"paid",payment_method:(s==null?void 0:s.method)||"cash",payment_date:x(s==null?void 0:s.date),notes:"",exemption_reason:(s==null?void 0:s.exemption)||""}),g=a=>{a.preventDefault();const i={...r,member_id:s.member_id,payment_month:s.month,payment_year:u,payment_date:r.payment_date||null};v.post("/payments",i,{preserveScroll:!0,onSuccess:()=>l()})},b=()=>{confirm("Are you sure you want to delete this payment record?")&&v.delete(`/payments/${s.id}`,{preserveScroll:!0,onSuccess:()=>l()})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4",children:["Update Payment - ",s.member_name]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:[s.month_name," ",u]}),e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Amount (RSD)",(s==null?void 0:s.expected)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-gray-500",children:["Expected: ",Number(s.expected).toLocaleString()]})]}),e.jsx("input",{type:"number",value:r.paid_amount,onChange:a=>o({...r,paid_amount:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{value:r.payment_status,onChange:a=>{const i=a.target.value;o({...r,payment_status:i,payment_date:i==="paid"&&!r.payment_date?m:r.payment_date})},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"exempt",children:"Exempt"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),r.payment_status==="exempt"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Exemption Reason"}),e.jsxs("select",{value:r.exemption_reason,onChange:a=>o({...r,exemption_reason:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"pocasni",children:"Pocasni"}),e.jsx("option",{value:"saradnik",children:"Saradnik"}),e.jsx("option",{value:"other",children:"Other"})]})]}),r.payment_status==="paid"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Method"}),e.jsxs("select",{value:r.payment_method,onChange:a=>o({...r,payment_method:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Date"}),e.jsx("input",{type:"date",value:r.payment_date,onChange:a=>o({...r,payment_date:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{value:r.notes,onChange:a=>o({...r,notes:a.target.value}),rows:2,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("div",{children:(s==null?void 0:s.id)&&e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Save Payment"})]})]})]})]})})}function O({member:s,year:u,annualConfig:l,onClose:j}){const m=new Date().toISOString().split("T")[0],x=new Date().getMonth()+1,[r,o]=h.useState({start_month:x,start_year:u,payment_method:"cash",payment_date:m}),[g,b]=h.useState(!1),a=["January","February","March","April","May","June","July","August","September","October","November","December"],f=(()=>{let n=r.start_month+11,p=r.start_year;return n>12&&(n-=12,p++),{month:n,year:p}})(),y=(l==null?void 0:l.annual_amount)||32e3,N=n=>{n.preventDefault(),b(!0),v.post("/payments/annual",{member_id:s.id,start_year:r.start_year,start_month:r.start_month,payment_method:r.payment_method,payment_date:r.payment_date},{preserveScroll:!0,onSuccess:()=>j(),onFinish:()=>b(!1)})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4",children:["Annual Payment - ",s.name]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded p-3 mb-4",children:[e.jsxs("p",{className:"text-sm text-purple-700",children:[e.jsx("strong",{children:"Amount:"})," ",Number(y).toLocaleString()," RSD"]}),e.jsxs("p",{className:"text-sm text-purple-700",children:[e.jsx("strong",{children:"Coverage:"})," 12 months"]})]}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Month"}),e.jsx("select",{value:r.start_month,onChange:n=>o({...r,start_month:parseInt(n.target.value)}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:a.map((n,p)=>e.jsx("option",{value:p+1,children:n},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Year"}),e.jsx("select",{value:r.start_year,onChange:n=>o({...r,start_year:parseInt(n.target.value)}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[u-1,u,u+1].map(n=>e.jsx("option",{value:n,children:n},n))})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded text-sm",children:[e.jsx("strong",{children:"Coverage period:"}),e.jsx("br",{}),a[r.start_month-1]," ",r.start_year," â†’ ",a[f.month-1]," ",f.year]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Method"}),e.jsxs("select",{value:r.payment_method,onChange:n=>o({...r,payment_method:n.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Date"}),e.jsx("input",{type:"date",value:r.payment_date,onChange:n=>o({...r,payment_date:n.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:j,className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50",children:g?"Processing...":`Pay ${Number(y).toLocaleString()} RSD`})]})]})]})})}export{z as default};
