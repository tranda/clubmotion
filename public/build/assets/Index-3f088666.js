import{u as S,r as g,j as e,L as v,a as u}from"./app-abf87045.js";import{L as C}from"./Layout-2d1c63de.js";/* empty css            */function M({year:t,members:x,stats:l,availableYears:j,filter:c}){const{auth:m}=S().props,[a,o]=g.useState(null),[b,h]=g.useState(!1);g.useEffect(()=>{let s=0,d=!1;const i=p=>{window.scrollY===0&&(s=p.touches[0].pageY,d=!0)},f=p=>{if(!d)return;p.touches[0].pageY-s>100&&(d=!1,u.reload())},N=()=>{d=!1};return document.addEventListener("touchstart",i),document.addEventListener("touchmove",f),document.addEventListener("touchend",N),()=>{document.removeEventListener("touchstart",i),document.removeEventListener("touchmove",f),document.removeEventListener("touchend",N)}},[]);const r=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],n=s=>{const d=c||"active";u.get(`/payments?year=${s}&filter=${d}`)},y=s=>{const d=s.target.value;u.get(`/payments?year=${t}&filter=${d}`)},w=(s,d,i)=>{o({...i,member_id:s.id,member_name:s.name,month:d,month_name:r[d-1]}),h(!0)},_=s=>{if(!s)return"bg-gray-50 border-gray-200";switch(s.status){case"paid":return"bg-green-50 border-green-300 text-green-900";case"pending":return"bg-yellow-50 border-yellow-300 text-yellow-900";case"overdue":return"bg-red-50 border-red-300 text-red-900";case"exempt":return"bg-gray-100 border-gray-400 text-gray-600";default:return"bg-gray-50 border-gray-200"}},k=(s,d)=>!s||!s.status?"":s.status==="exempt"?s.exemption==="pocasni"?"POC":s.exemption==="saradnik"?"SAR":"OTH":s.status==="paid"?Math.round(s.amount):s.status==="overdue"?"!":"â—‹";return e.jsxs(C,{children:[e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:["Payments Management - ",t]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:c??"active",onChange:y,className:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"active",children:"Active"})]}),e.jsx("select",{value:t,onChange:s=>n(s.target.value),className:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:j.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(v,{href:`/payments/export-template/${t}`,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"ðŸ“¥ Download Template"}),e.jsx(v,{href:"/payments/import",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"ðŸ“¤ Import CSV"}),e.jsx(v,{href:`/payments/initialize?year=${t+1}`,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"âž• Initialize Year"})]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Collected"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[Number((l==null?void 0:l.total_collected)||0).toLocaleString()," RSD"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Paid"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(l==null?void 0:l.paid_count)||0})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:(l==null?void 0:l.pending_count)||0})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Overdue"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:(l==null?void 0:l.overdue_count)||0})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Exempt"}),e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:(l==null?void 0:l.exempt_count)||0})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase sticky left-0 bg-gray-50 z-10",children:"Member"}),e.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"#"}),r.map((s,d)=>e.jsx("th",{className:"px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase",children:s},d))]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-3 py-2 text-sm font-medium text-gray-900 sticky left-0 bg-white z-10",children:[s.name,s.exemption_status!=="none"&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",s.exemption_status,")"]})]}),e.jsx("td",{className:"px-2 py-2 text-sm text-gray-500",children:s.membership_number}),[1,2,3,4,5,6,7,8,9,10,11,12].map(d=>{const i=s.months[d];return e.jsx("td",{onClick:()=>w(s,d,i),className:`px-2 py-2 text-center text-xs font-semibold border cursor-pointer hover:opacity-75 ${_(i)}`,children:k(i)},d)})]},s.id))})]})})}),e.jsxs("div",{className:"mt-4 flex gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-200 border border-green-300"}),e.jsx("span",{children:"Paid"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-yellow-200 border border-yellow-300"}),e.jsx("span",{children:"Pending"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-200 border border-red-300"}),e.jsx("span",{children:"Overdue"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200 border border-gray-400"}),e.jsx("span",{children:"Exempt"})]})]})]}),b&&e.jsx(E,{payment:a,year:t,onClose:()=>h(!1),canDelete:m.user.role_id===1||m.user.role_id===2})]})}function E({payment:t,year:x,onClose:l,canDelete:j}){const c=new Date().toISOString().split("T")[0],m=r=>{if(!r)return c;if(r.includes(".")){const n=r.split(".");if(n.length===3)return`${n[2]}-${n[1].padStart(2,"0")}-${n[0].padStart(2,"0")}`}return r},[a,o]=g.useState({paid_amount:(t==null?void 0:t.amount)||(t==null?void 0:t.expected)||"",payment_status:(t==null?void 0:t.status)||"paid",payment_method:(t==null?void 0:t.method)||"cash",payment_date:m(t==null?void 0:t.date),notes:"",exemption_reason:(t==null?void 0:t.exemption)||""}),b=r=>{r.preventDefault();const n={...a,member_id:t.member_id,payment_month:t.month,payment_year:x,payment_date:a.payment_date||null};u.post("/payments",n,{preserveScroll:!0,onSuccess:()=>l()})},h=()=>{confirm("Are you sure you want to delete this payment record?")&&u.delete(`/payments/${t.id}`,{preserveScroll:!0,onSuccess:()=>l()})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4",children:["Update Payment - ",t.member_name]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:[t.month_name," ",x]}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Amount (RSD)",(t==null?void 0:t.expected)&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-gray-500",children:["Expected: ",Number(t.expected).toLocaleString()]})]}),e.jsx("input",{type:"number",value:a.paid_amount,onChange:r=>o({...a,paid_amount:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{value:a.payment_status,onChange:r=>{const n=r.target.value;o({...a,payment_status:n,payment_date:n==="paid"&&!a.payment_date?c:a.payment_date})},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"exempt",children:"Exempt"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),a.payment_status==="exempt"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Exemption Reason"}),e.jsxs("select",{value:a.exemption_reason,onChange:r=>o({...a,exemption_reason:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"pocasni",children:"Pocasni"}),e.jsx("option",{value:"saradnik",children:"Saradnik"}),e.jsx("option",{value:"other",children:"Other"})]})]}),a.payment_status==="paid"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Method"}),e.jsxs("select",{value:a.payment_method,onChange:r=>o({...a,payment_method:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Date"}),e.jsx("input",{type:"date",value:a.payment_date,onChange:r=>o({...a,payment_date:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{value:a.notes,onChange:r=>o({...a,notes:r.target.value}),rows:2,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("div",{children:(t==null?void 0:t.id)&&e.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Save Payment"})]})]})]})]})})}export{M as default};
